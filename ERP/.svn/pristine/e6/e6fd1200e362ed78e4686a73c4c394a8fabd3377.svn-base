

<div class="row-fluid cscustomer">
    <div class="span12">
        <h3 class="header smaller lighter blue">Customer Infomation</h3>
        <div class="row-fluid">
            <div class="span4">
                <ul class="unstyled spaced">
                    <li> <i class="icon-caret-right blue"></i><span class="label-info-popup">CusID: </span> <span id="Cus_EmployeeID"></span> <span id="Cus_GroupID"></span></li>
                    <li>
                        <i class="icon-caret-right blue"></i><span class="label-info-popup">Fullname: </span> <span id="Cus_FullName"></span>
                        <span class="help-button" data-rel="popover" data-trigger="hover" id="Cus_CustomerNote" style="display:none;" data-placement="right" title="" data-original-title="Customer Note">I</span>
                        <span class="help-button" data-rel="popover" data-trigger="hover" id="Cus_DCNote" style="display:none;" data-placement="right" title="" data-original-title="DC Customer Note">M</span>
                        <span class="help-button" data-rel="popover" data-trigger="hover" id="Cus_BadDebt" style="display:none;" data-placement="right" title="" data-original-title="Bad Debt Infomation">D</span>
                    </li>
                    <li>
                        <i class="icon-caret-right blue"></i><span class="label-info-popup">Phone: </span> <span id="Cus_Phone"></span>
                    </li>
                    <li> <i class="icon-caret-right blue"></i><span class="label-info-popup">Email: </span> <span id="Cus_Email"></span></li>
                </ul>
            </div>

            <div class="span3">
                <ul class="unstyled spaced">
                    <li> <i class="icon-caret-right blue"></i><span class="label-info-popup">Gender: </span> <span id="Cus_Gender"></span></li>
                    <li> <i class="icon-caret-right blue"></i><span class="label-info-popup">BirthDate: </span> <span id="Cus_Birthday"></span></li>
                    <li> <i class="icon-caret-right blue"></i><span class="label-info-popup">PhysicalID: </span> <span id="Cus_PhysicalID"></span></li>
                    <li> <i class="icon-caret-right blue"></i><span class="label-info-popup">Position: </span> <span id="Cus_Position"></span></li>
                </ul>
            </div>

            <div class="span5">
                <ul class="unstyled spaced">
                    <li> <i class="icon-caret-right blue"></i><span class="label-info-popup">DC Status: </span> <span id="Cus_Status"></span> | <span class="label-info-popup">Actual Status: </span> <span id="Cus_AccountStauts"></span></li>
                    <li> <i class="icon-caret-right blue"></i><span class="label-info-popup">Credit Limit: </span> <span id="Cus_CreditLimit"></span> | <span class="label-info-popup">RunningBalance: </span> <span id="Cus_RunningBalance"></span></li>
                    <li> <i class="icon-caret-right blue"></i><span class="label-info-popup">Available Credit: </span> <span id="Cus_AvailableCredit"></span> | <span class="label-info-popup">SettledBalance: </span> <span id="Cus_SettledBalance"></span></li>
                    <li> <i class="icon-caret-right blue"></i><span class="label-info-popup">Due Limit: </span> <span id="Cus_DueLimit"></span> | <span class="label-info-popup">DueBalance: </span> <span id="Cus_DueBalance"></span></li>
                </ul>
            </div>
        </div>
        <div class="row-fluid" style="  margin-bottom: -22px;">
            <div class="span4">
                <ul class="unstyled spaced">
                    <li> <i class="icon-caret-right blue"></i><span class="label-info-popup">EmployeeID: </span> <span id="Cus_EmployeeIDxx"></span></li>
                </ul>
            </div>
            <div class="span8">
                <ul class="unstyled spaced">
                    <li> <i class="icon-caret-right blue"></i><span class="label-info-popup">Address: </span> <span id="Cus_Address"></span></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="row-fluid" style="margin-bottom:10px;">
        <div class="span12" style="margin-top:10px;">
            <h3 class="header smaller lighter green">Organization Infomation</h3>
            <div class="row-fluid">
                <div class="span7">
                    <ul class="unstyled spaced">
                        <li> <i class="icon-caret-right green"></i><span class="label-info-popup">OrganizationID: </span> <span id="Org_OrgID"></span></li>
                        <li> <i class="icon-caret-right green"></i><span class="label-info-popup">Long Name: </span> <span id="Org_LongName"></span></li>
                        <li id="removearea"> <i class="icon-caret-right green"></i><span id="Org_Area"></span> <span id="Org_Region"></span> <span id="Org_Brach111"></span></li>
                        <li> <i class="icon-caret-right green"></i><span class="label-info-popup">Registration: </span> <span id="Org_Registration"></span></li>
                    </ul>
                </div>
                <div class="span5">
                    <ul class="unstyled spaced">
                        <li>
                            <i class="icon-caret-right green"></i><span class="label-info-popup">Org Status: </span> <span id="Org_OrgStatus"></span>
                            <button class="btn btn-minier btn-grey" onclick="OrganizationEdit()" style="border-radius: 15px;padding: 0px 10px 0px 10px;">Edit</button>
                        </li>
                        <li> <i class="icon-caret-right green"></i><span class="label-info-popup">Settlement Date: </span> <span id="Org_SD"></span></li>
                        <li> <i class="icon-caret-right green"></i><span class="label-info-popup">RBD: </span> <span id="Org_RBD"></span></li>
                        <li> <i class="icon-caret-right green"></i><span class="label-info-popup">PD: </span> <span id="Org_PD"></span></li>
                    </ul>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12">
                    <ul class="unstyled spaced">
                        <li>
                            <i class="icon-caret-right green"></i><span class="label-info-popup">Address: </span> <span id="Org_Address"></span>
                            <a onclick="OrganizationForTeleSaledetail()" style="background: transparent none!important;color: #08c!important;cursor:pointer;margin-left:10px;">More detail</a>
                        </li>
                        <li> <i class="icon-caret-right green"></i><span class="label-info-popup">Services: </span> <span id="AirTime"></span> <span id="Cash2Home"></span> <span id="PhysicalGoods"></span> <span id="Services"></span></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>


@(Html.Kendo()
      .Window()
      .Name("windowprint")
      .Title("Infomation Customer List")
      .Content(@<text>

        @(Html.Kendo()
        .Grid<ERPAPD.Models.DW_DC_Customer>()
        .Name("GridCustomerAssignmentSearch")
        .Columns(columns =>
        {
            columns.Bound(p => p.CustomerID).Width(160).Hidden();
            columns.Bound(p => p.CustomerID).HeaderTemplate("").ClientTemplate("<button type='button' class='btn-success btn btn-minier' style='display:inline-block;color:white;' onclick ='GetCustomerForPopup(this)' ><i class='fa fa-microphone bigger-100'></i>Select</button>").Title("Action").Width(55);
            columns.Bound(p => p.CustomerID).Width(160);
            columns.Bound(p => p.FamilyName).Width(140).Title("Full name");
            columns.Bound(p => p.MobilePhone).Width(80).Title("Phone");
            columns.Bound(p => p.Gender).Width(80);
            columns.Bound(p => p.PhysicalID).Width(85);
            columns.Bound(p => p.Email).Width(140);
            columns.Bound(p => p.OrganizationID).Width(100).Title("Organization");
            columns.Bound(p => p.GroupID).Width(55).Title("Group");
            columns.Bound(p => p.DCStatus).Width(85).Title("DCStatus");
            columns.Bound(p => p.ActualStatus).Width(95).Title("ActualStatus");
        })
        .Navigatable()
        .ColumnMenu()
        .Selectable(selectable => selectable.Mode(GridSelectionMode.Single).Type(GridSelectionType.Row))
        .HtmlAttributes(new { @style = "height:190px;margin-top:7px;" })
        .Events(events => { events.DataBound("onDataBound"); })
        .Sortable()
        //.Scrollable(scrollable => scrollable.Virtual(false))
        .Filterable()
        .AutoBind(false)
        //.Resizable(resize => resize.Columns(true))
        .DataSource(dataSource => dataSource
        .Ajax()
            .Events(events => { events.Error("error_handler"); })
            .Model(model =>
            {
                model.Id(p => p.CustomerID);
                model.Field(p => p.RowCreatedTime).Editable(false);
                model.Field(p => p.RowCreatedUser).Editable(false);
            }).Read("DW_DC_Customer_ReadSearch", "CSInfoCustomer"))
        )
    </text>)
      .Draggable()
      .Resizable()
      .Visible(false)
      .Width(1100)
      .Actions(actions => actions.Close())
)
<script>
    //$('[data-rel=tooltip]').tooltip({ container: 'body' });
    $('[data-rel=popover]').popover({ container: 'body', html: true });

    function GetDataCustomerByID(item) {
        if (item == null || item == "") {
            return false;
        }
        $.post(r + "/CSInfoCustomer/CustomerInfo", { customerID: item }, function (data) {
            $("#Cus_FullName").text(data.FamilyName + " " + data.GivenName);
            $("#Cus_EmployeeID").text(data.CustomerID);
            $("#Cus_PhysicalID").text(data.PhysicalID);
            $("#Cus_Phone").text(data.MobilePhone);
            $("#Cus_CreditLimit").text($.number(data.CreditLimit));
            $("#Cus_Birthday").text(data.DateOfBirth.replace("00:00:00 ", "").replace("07:00:00 ", "").replace("07:06:40 ", ""));
            $("#Cus_AvailableCredit").text($.number(data.AvailableCredit));
            $("#Cus_DueLimit").text($.number(data.DueLimit));

            $("#Cus_RunningBalance").text($.number(data.RunningBalance));
            $("#Cus_SettledBalance").text($.number(data.SettledBalance));
            $("#Cus_DueBalance").text($.number(data.DueBalance));

            $("#Cus_Department").text(data.Department);
            $("#Cus_Email").text(data.Email);
            $("#Cus_Gender").text(data.Gender);

            if (data.NoteCustomer.length > 0) {
                $("#Cus_CustomerNote").show();
                $("#Cus_CustomerNote").attr("data-content", data.NoteCustomer);
            }
            else {
                $("#Cus_CustomerNote").hide();
            }
            if (data.DCNote.length > 0) {
                $("#Cus_DCNote").show();
                $("#Cus_DCNote").attr("data-content", data.DCNote);
            }
            else {
                $("#Cus_DCNote").hide();
            }

            
            if (data.ResignedReason.length > 0) {
                $("#Cus_BadDebt").show();
                var text = "<p><span class='label-info-popup'>Resigned Date: </span>" + kendo.toString(kendo.parseDate(data.ResignedDate), 'dd/MM/yyyy') + "<br/> ";
                text += "<span class='label-info-popup'>Informed Date: </span> " + kendo.toString(kendo.parseDate(data.InformedDate), 'dd/MM/yyyy') + " <br/> ";
                text += "<span class='label-info-popup'>Reason: </span>" + data.ResignedReason + "<br/> ";
                text += "<span class='label-info-popup'>Action Code: </span>" + data.ActionCode + " <br/>";
                text += "<span class='label-info-popup'>Last Action Status: </span>" + data.LastActionStatus + "  <br/> ";
                text += "<span class='label-info-popup'>Note: </span> " + data.ResNote + "</p>";
                $("#Cus_BadDebt").attr("data-content", text);
            }
            else {
                $("#Cus_BadDebt").hide();
            }

            $("#Cus_AccountStauts").text(data.ActualStatus);
            if (data.GroupID == "VIP 1") {
                $("#Cus_GroupID").html("<span class='badge badge-important' style='font-size: 10px;padding-top:0px;padding-bottom:0px;'>VIP 1</span>");
            }
            else if (data.GroupID == "VIP 2") {
                $("#Cus_GroupID").html("<span class='badge badge-info' style='font-size: 10px;padding-top:0px;padding-bottom:0px;'>VIP 2</span>");
            }
            else if (data.GroupID == "VIP 0") {
                $("#Cus_GroupID").html("<span class='badge badge-grey' style='font-size: 10px;padding-top:0px;padding-bottom:0px;'>VIP 0</span>");
            }
            else {
                $("#Cus_GroupID").html("");
            }

            $("#Cus_Position").text(data.Position);
            $("#Cus_Status").text(data.DCStatus);

            $("#Cus_EmployeeIDxx").text(data.EmployeeID);
            $("#Cus_Address").text(data.Address);

            var orgzz = item.split(":");
            GetDataOrganizationInfoForTeleSale(orgzz[0]);
            $("#CurrentCustomerIDForPopup").val("");
            $("#CurrentCustomerIDForPopup").val(item);

            $("#formbutton").show();

            grid = $("#GridTransactionPopupForTeleSale").data("kendoGrid");
            grid.dataSource.transport.options.read.url = r + "/TelesalePluginCode/GetOrderItemForTeleSale?customerID=" + item;
            $("#GridTransactionPopupForTeleSale").data("kendoGrid").dataSource.read();

            var orgx = item.split(":");
            grid1 = $("#listView").data("kendoListView");
            grid1.dataSource.transport.options.read.url = r + "/TelesalePluginCode/ReadByPromotion?TypeTab=TeleSaleType001&Organization=" + orgx[0];
            $("#listView").data("kendoListView").dataSource.read();
        });
    }

    function GetDataOrganizationInfoForTeleSale(OrgID) {
        if (OrgID == null || OrgID == "") {
            return false;
        }
        $.post(r + "/CSInfoCustomer/OrganizationInfo", { OrganizationID: OrgID }, function (data) {
            $("#Org_OrgID").text(data.OrganizationID);
            $("#Org_LongName").text(data.LongName);
            $("#Org_Address").text(data.Address);
            $("#Org_OrgID").text(data.OrganizationID);
            $("#Org_SD").text(data.SettlementDate);
            $("#Org_OrgStatus").text(data.OrgStatus);
            $("#Org_DD").text(data.DueDate);
            $("#Org_Registration").text(data.Registration);

            if (data.AreaName.length > 0) {
                $("#removearea").show();
                $("#Org_Area").html("<span class='label-info-popup'>Area: </span> " + data.AreaName);
            }
            else {
                $("#removearea").hide();
            }

            if (data.RegionName.length > 0) {
                $("#Org_Region").html(" - <span class='label-info-popup'>Region: </span>" + data.RegionName);
            }
            if (data.BranchName.length > 0) {
                $("#Org_Brach111").html(" - <span class='label-info-popup'>Branch: </span>" + data.BranchName);
            }

            $("#Org_RBD").text(data.RegionalBD);
            $("#Org_PD").text(data.PD);

            $("#AirTime").html("");
            $("#Cash2Home").html("");
            $("#PhysicalGoods").html("");
            $("#Services").html("");

            if (data.OrgRule.length > 0) {
                $("#AirTime").html("<span class='label label-inverse' style='border-radius: 10px;'>AirTime</span>");
            }
            else {
                if (data.Cashadvance == "true") {
                    $("#AirTime").html("<span class='label label-inverse' style='border-radius: 10px;'>AirTime</span>");
                    $("#Cash2Home").html("<span class='label label-info' style='border-radius: 10px;'>CashAdvance</span>");
                    $("#PhysicalGoods").html("<span class='label label-warning' style='border-radius: 10px;'>PhysicalGoods</span>");
                    $("#Services").html("<span class='label label-success' style='border-radius: 10px;'>Services</span>");
                } else {
                    $("#AirTime").html("<span class='label label-inverse' style='border-radius: 10px;'>AirTime</span>");
                    $("#PhysicalGoods").html("<span class='label label-warning' style='border-radius: 10px;'>PhysicalGoods</span>");
                    $("#Services").html("<span class='label label-success' style='border-radius: 10px;'>Services</span>");
                }
            }
        });
    }

    function OrganizationForTeleSaledetail() {
        var OrgID = $("#Org_OrgID").text();
        if (OrgID == null || OrgID == "") {
            return false;
        }
        $("#windowOrganizationPopupTeleSaleByOrganizationID").kendoWindow({
            actions: {}, /*from Vlad's answer*/
            //Height: "355px", // if you need full screen give 100% for both height and width
            //width: "1355px", // if you need the window to fix to your content remove H & W
            draggable: true,
            modal: true,
            resizable: false,
            visible: false /*don't show it yet*/
        }).data("kendoWindow").center().open();

        $.post(r + "/CSInfoCustomer/OrganizationInfo", { OrganizationID: OrgID }, function (data) {
            $("#Org_OrganizationID").text(data.OrganizationID);
            $("#Org_LongName111").text(data.LongName);
            $("#Org_Address1").text(data.Address);
            $("#Org_CreditLimitRules").text(data.CreditLimitRules);
            $("#Org_SettlementDate").text(data.SettlementDate);
            $("#Org_Branch").text(data.BranchName);
            $("#Org_RegionalBD").text(data.RegionalBD);

            $("#Org_Region111").text(data.RegionName);

            $("#Org_AreaName1").text(data.AreaName);
            $("#Org_Registration1").text(data.Registration);
            $("#Org_DebtCollection1").text(data.PaymentType);
            $("#Org_OnsiteSchedule1").text(data.OnsiteSchedule);

            $("#Org_RegionalBDEmail").text(data.RegionalBDEmail);
            $("#Org_RegionalBDPhone").text(data.RegionalBDPhone);
            $("#Org_PD1").text(data.PD);
            $("#Org_PDEmail1").text(data.PDEmail);
            $("#Org_PDPhone1").text(data.PDPhone);

            $("#Org_IcareCenter").text(data.IcareCenter);
            $("#Org_IcareAddress").text(data.IcareAddress);
            $("#Org_IcareMainContact").text(data.IcareMainContact);
            $("#Org_IcarePhone").text(data.IcarePhone);
            $("#Org_ContractStauts").text(data.ContractStauts);
            $("#Org_NotebyCS").text(data.NoteByCS);

            $("#AirTimeOrg").html("");
            $("#Cash2HomeOrg").html("");
            $("#PhysicalGoodsOrg").html("");
            $("#ServicesOrg").html("");

            if (data.OrgRule.length > 0) {
                $("#AirTimeOrg").html("<span class='label label-inverse' style='border-radius: 10px;'>AirTime</span>");
            }
            else {
                if (data.Cashadvance == "true") {
                    $("#AirTimeOrg").html("<span class='label label-inverse' style='border-radius: 10px;'>AirTime</span>");
                    $("#Cash2HomeOrg").html("<span class='label label-info' style='border-radius: 10px;'>CashAdvance</span>");
                    $("#PhysicalGoodsOrg").html("<span class='label label-warning' style='border-radius: 10px;'>PhysicalGoods</span>");
                    $("#ServicesOrg").html("<span class='label label-success' style='border-radius: 10px;'>Services</span>");
                } else {
                    $("#AirTimeOrg").html("<span class='label label-inverse' style='border-radius: 10px;'>AirTime</span>");
                    $("#PhysicalGoodsOrg").html("<span class='label label-warning' style='border-radius: 10px;'>PhysicalGoods</span>");
                    $("#ServicesOrg").html("<span class='label label-success' style='border-radius: 10px;'>Services</span>");
                }
            }
        });
    }

    function filterCustomerSearchForTeleSale() {
        var keyword = $("#txtCustomerIDSearchForteleSale").val();
        if (keyword.length < 3) {
            $.gritter.add({
                text: "Please input your keyword to search (minimum 3 characters)",
                class_name: 'gritter-error'
            });
        }
        else {
            $(document).ajaxStart($.blockUI({ message: '<i class="icon-spinner icon-spin blue bigger-125" style="font-size:30px;"></i>', theme: false })).ajaxStop($.unblockUI);
            $.post(r + "/CSInfoCustomer/Search_Customer", { keyword: keyword }, function (data) {
                if (data.length == 0) {
                    $.gritter.add({
                        text: "Data Empty",
                        class_name: 'gritter-error'
                    });
                }
                else if (data.length == 1) {
                    GetDataCustomerByID(data[0].CustomerID);
                    $("#InfoForm").show();
                    $("#DefaultTab").click();
                }
                else {
                    $("#windowprint").kendoWindow({
                        actions: {}, /*from Vlad's answer*/
                        draggable: true,
                        modal: true,
                        resizable: true,
                        visible: false /*don't show it yet*/
                    }).data("kendoWindow").center().open();
                    $("#GridSearchResult").show();
                    grid = $("#GridCustomerAssignmentSearch").data("kendoGrid");
                    grid.dataSource.transport.options.read.url = r + "/CSInfoCustomer/DW_DC_Customer_ReadSearch?key=" + $("#txtCustomerIDSearchForteleSale").val();
                    $("#GridCustomerAssignmentSearch").data("kendoGrid").dataSource.read();
                }
            });
        }
    }

    $('#txtCustomerIDSearchForteleSale').bind('keypress', function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) {
            filterCustomerSearchForTeleSale();
        }
    });

    function GetCustomerForPopup(obj) {
        var row = $(obj).closest('tr');
        var customerID = $(row).find("td:eq(0)").text();
        $("#windowprint").data("kendoWindow").close();
        GetDataCustomerByID(customerID);
        $("#InfoForm").show();

        $("#DefaultTab").click();
    }

    function onDataBound(e) {
        if (this.dataSource.total() == 1) {
            $("#GridSearchResult").hide();
        }
    }

    function error_handler(e) {
        if (e.errors) {
            var message = "@Resources.Multi.Error:\n";
            $.each(e.errors, function (key, value) {
                if ('errors' in value) {
                    $.each(value.errors, function () {
                        message += this + "\n";
                    });
                }
            });
            $.gritter.add({
                // (string | mandatory) the heading of the notification
                title: '',
                // (string | mandatory) the text inside the notification
                text: message,
                class_name: 'gritter-error'
            });
        }
    }
</script>
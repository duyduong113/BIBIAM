@{
    int glb_contractPR = 0;
    int glb_stt = 1;
}
<div class="row-fluid" id="pr-wrapper">
    <label>
        @if (ViewBag.typeService != null && ViewBag.typeService == 3)
        {
            <input id="ckb-pr" name="form-field-checkbox" type="checkbox" class="ace" checked="checked">
        }
        else
        {
            <input id="ckb-pr" name="form-field-checkbox" type="checkbox" class="ace">
        }
        <span class="lbl" style="font-weight:bold"> Đăng HĐ PR</span>
    </label>
    <div class="row-fluid" id="contractPR-table" style="display:none">
        <div class="span12">
            <table class="table table-striped table-bordered table-hover" style="width:100%">
                <thead style="background-color:#86DBF7;">
                    <tr style="text-align:center">
                        <td rowspan="2">#</td>
                        <td rowspan="2">STT</td>
                        <td rowspan="2">Mã Book</td>
                        <td rowspan="2">Ngày đăng</td>
                        <td rowspan="2">Giờ</td>
                        <td rowspan="2">Website</td>
                        <td colspan="4">DẪN ĐĂNG LẠI</td>
                        <td rowspan="2">TT Bài</td>
                        <td rowspan="2">Đơn giá chưa CK</td>
                        <td rowspan="2">CK1</td>
                        <td rowspan="2">CK2</td>
                        <td rowspan="2">CK3</td>
                        <td rowspan="2">Tiền đã CK</td>
                        <td rowspan="2">Ngày trả</td>
                        <td rowspan="2">Số tiền</td>
                        <td rowspan="2">Nhãn hàng</td>
                        <td rowspan="2">Ghi chú</td>
                    </tr>
                    <tr style="text-align:center">
                        <td>Website</td>
                        <td>Chuyên mục</td>
                        <td>Vị trí</td>
                        <td>Vùng miền</td>
                    </tr>
                </thead>
                <tfoot>
                    <tr>
                        <td colspan="12" style="text-align:center">
                            @*<input type="button" class="btn btn-small btn-pink" value="Lưu" onclick="SaveContractPR()" />*@
                            @*<input type="button" class="btn btn-small btn-success" value="Thêm vị trí" onclick="plusContractPR()" />*@
                            <input type="button" class="btn btn-small btn-success pull-left" value="Chọn vị trí" onclick="showPPListBooking(2)" />
                            <input type="button" class="btn btn-small btn-success pull-left" value="Nhân bản" onclick="CloneContractPR()" />
                            @*<input type="button" class="btn btn-small btn-success" value="Xuất CNPS " />
                                <input type="button" class="btn btn-small btn-success" value="Tham khảo KPI " />*@
                        </td>
                        <td colspan="12">
                            @if (ViewBag.listInfoOrders != null)
                            {
                                <p class="pull-left" style="font-size:15px;color:red">Hạn mức cho phép xuất bản QC: <span id="dm_chophep_pr_contract">@ViewBag.listInfoOrders.c_han_muc_pr_thuong.ToString("#,##0")</span></p>
                            }
                            else
                            {
                                <p class="pull-left" style="font-size:15px;color:red">Hạn mức cho phép xuất bản QC: <span id="dm_chophep_pr_contract">0</span></p>
                            }
                            <p class="pull-right" style="font-size:15px;color:red"> Tổng tiền đăng đợt này: <span id="tong_tien_dang_dot_pr_contract">0</span></p>
                        </td>
                    </tr>
                </tfoot>
                @if (ViewBag.listHDT != null && ViewBag.listHDT.Count > 0)
                {
                    <tbody>

                        @foreach (var item in ViewBag.listHDT)
                        {
                            <tr data-pkservice="@item.pk_services">
                                <td><input type="checkbox"></td>
                                <td>@glb_stt</td> @{glb_stt++;}
                                <td>
                                    <input class="input-mini bookcode" type="text" value="@item.c_book_code" placeholder="Mã book">
                                    <input type="hidden" class="input-mini  fk_adv" value="@item.fk_adv" />
                                    <input type="hidden" class="input-mini  c_dot_order" value="@item.c_dot_order" />
                                    <input type="hidden" class="input-mini  pk_services" value="@item.pk_services" />
                                </td>
                                <td>
                                    <input class="date-picker input-mini dateUp" type="text" value="@item.c_ngay_len.ToString("dd/MM/yyyy")" data-date-format="dd/mm/yyyy" placeholder="dd/mm/yyyy" style="width:65px" />
                                </td>
                                <td>
                                    <input class="input-value-suggess item-time" type="hidden" value="@item.c_gio" />
                                    @(Html.Kendo().AutoComplete()
                                        .Name("txt-Adv-contractPR-" + glb_contractPR)
                                        .DataTextField("Name")
                                        .Placeholder("Giờ lên")
                                        .Filter("contains")
                                        .MinLength(1)
                                        .HtmlAttributes(new { style = "width:100%", @class = "item-time-name", @onfocus = "setGlobalPackage(" + glb_contractPR + ")" })
                                        .DataSource(source =>
                                        {
                                            source.Read(read =>
                                            {
                                                read.Action("SuggestTime", "CRM_ProposedAdvertisement", new { PKList = 72 })
                                                    .Data("onDataContractPR");
                                            })
                                            .ServerFiltering(true);
                                        })
                                        .Events(e =>
                                        {
                                            e.Select("onSelectContractPRItem");
                                        })
                                    )
                                    <script>
                                        $("#txt-Adv-contractPR-@glb_contractPR").val("@Html.Raw(item.c_gio_name)");
                                    </script>
                                    @{glb_contractPR++;}
                                </td>
                                <td>
                                    <input class="input-value-suggess item-web1" type="hidden" value="khampha.vn" />
                                    @(Html.Kendo().AutoComplete()
                                        .Name("txt-Adv-contractPR-" + glb_contractPR)
                                        .DataTextField("Name")
                                        .Placeholder("Website")
                                        .Filter("contains")
                                        .MinLength(1)
                                        .HtmlAttributes(new { style = "width:100%", @class = "input-mini item-web1-name", @onfocus = "setGlobalPackage(" + glb_contractPR + ")" })
                                        .DataSource(source =>
                                        {
                                            source.Read(read =>
                                            {
                                                read.Action("SuggestWebsite", "CRM_ProposedAdvertisement", new { PKList = 20 })
                                                    .Data("onDataContractPR");
                                            })
                                            .ServerFiltering(true);
                                        })
                                        .Events(e =>
                                        {
                                            e.Select("onSelectContractPRItem");
                                        })
                                    )
                                    <script>
                                        $("#txt-Adv-contractPR-@glb_contractPR").val("khampha.vn");
                                    </script>
                                    @{glb_contractPR++;}
                                </td>
                                <td>
                                    <input class="input-value-suggess item-web2" type="hidden" value="@item.c_website" />
                                    @(Html.Kendo().AutoComplete()
                                        .Name("txt-Adv-contractPR-" + glb_contractPR)
                                        .DataTextField("Name")
                                        .Placeholder("Website")
                                        .Filter("contains")
                                        .MinLength(1)
                                        .HtmlAttributes(new { style = "width:100%", @class = "input-mini item-web2-name", @onfocus = "setGlobalPackage(" + glb_contractPR + ")" })
                                        .DataSource(source =>
                                        {
                                            source.Read(read =>
                                            {
                                                read.Action("SuggestWebsite", "CRM_ProposedAdvertisement", new { PKList = 20 })
                                                    .Data("onDataContractPR");
                                            })
                                            .ServerFiltering(true);
                                        })
                                        .Events(e =>
                                        {
                                            e.Select("onSelectContractPRItem");
                                        })
                                    )
                                    <script>
                                        $("#txt-Adv-contractPR-@glb_contractPR").val("@Html.Raw(item.c_website_name)");
                                    </script>
                                    @{glb_contractPR++;}
                                </td>
                                <td>
                                    <input class="input-value-suggess item-category" type="hidden" value="@item.c_category" />
                                    @(Html.Kendo().AutoComplete()
                                        .Name("txt-Adv-contractPR-" + glb_contractPR)
                                        .DataTextField("Name")
                                        .Filter("contains")
                                        .Placeholder("Chuyên mục")
                                        .MinLength(1)
                                        .HtmlAttributes(new { style = "width:100%", @class = "input-mini item-category-name", @onfocus = "setGlobalPackage(" + glb_contractPR + ")" })
                                        .DataSource(source =>
                                        {
                                            source.Read(read =>
                                            {
                                                read.Action("SuggestCategory", "CRM_ProposedAdvertisement", new { PKList = 22 })
                                                    .Data("onDataContractPR");
                                            })
                                            .ServerFiltering(true);
                                        })
                                        .Events(e =>
                                        {
                                            e.Select("onSelectContractPRItem");
                                        })
                                    )
                                    <script>
                                        $("#txt-Adv-contractPR-@glb_contractPR").val("@Html.Raw(item.c_category_name)");
                                    </script>
                                    @{glb_contractPR++;}
                                </td>
                                <td>
                                    <input class="input-value-suggess item-location" type="hidden" value="@item.c_location" />
                                    @(Html.Kendo().AutoComplete()
                                        .Name("txt-Adv-contractPR-" + glb_contractPR)
                                        .DataTextField("Name")
                                        .Placeholder("Vị trí")
                                        .Filter("contains")
                                        .MinLength(1)
                                        .HtmlAttributes(new { style = "width:100%", @class = "input-mini item-location-name", @onfocus = "setGlobalPackage(" + glb_contractPR + ")" })
                                        .DataSource(source =>
                                        {
                                            source.Read(read =>
                                            {
                                                read.Action("SuggestLocation", "CRM_ProposedAdvertisement", new { PKList = 23 })
                                                    .Data("onDataContractPR");
                                            })
                                            .ServerFiltering(true);
                                        })
                                        .Events(e =>
                                        {
                                            e.Select("onSelectContractPRItem");
                                        })
                                    )
                                    <script>
                                        $("#txt-Adv-contractPR-@glb_contractPR").val("@Html.Raw(item.c_location_name)");
                                    </script>
                                    @{glb_contractPR++;}
                                </td>
                                <td>
                                    <input class="input-value-suggess item-region" type="hidden" value="@item.c_vung_mien" />
                                    @(Html.Kendo().AutoComplete()
                                        .Name("txt-Adv-contractPR-" + glb_contractPR)
                                        .DataTextField("Name")
                                        .Filter("contains")
                                        .Placeholder("Vùng miền")
                                        .MinLength(1)
                                        .HtmlAttributes(new { style = "width:100%", @class = "input-mini item-region-name", @onfocus = "setGlobalPackage(" + glb_contractPR + ")" })
                                        .DataSource(source =>
                                        {
                                            source.Read(read =>
                                            {
                                                read.Action("SuggestRegion", "CRM_ProposedAdvertisement", new { PKList = 52 })
                                                    .Data("onDataContractPR");
                                            })
                                            .ServerFiltering(true);
                                        })
                                        .Events(e =>
                                        {
                                            e.Select("onSelectContractPRItem");
                                        })
                                    )
                                    <script>
                                        $("#txt-Adv-contractPR-@glb_contractPR").val("@Html.Raw(item.c_vung_mien_name)");
                                    </script>
                                    @{glb_contractPR++;}
                                </td>
                                <td>
                                    <input class="input stt" type="text" style="width:30px" value="@item.c_so_luong" placeholder="TT Bài">
                                </td>
                                <td>
                                    <input onchange="SumMoneyServiceContractPR()" class="input-mini currency moneyBeforeDiscount" value="@item.c_don_gia.ToString("#,##0")" type="text" data-thousands="," data-decimal="." data-precision="0" placeholder="Tiền chưa CK">
                                </td>
                                <td>
                                    <input onchange="changeDiscount()" class="input-mini currency ck1" value="@item.c_chiet_khau1.ToString("#,##0")" type="text" data-thousands="," data-decimal="." data-precision="0" placeholder="CK1">
                                </td>
                                <td>
                                    <input onchange="changeDiscount()" class="input-mini currency ck2" value="@item.c_chiet_khau2.ToString("#,##0")" type="text" data-thousands="," data-decimal="." data-precision="0" placeholder="CK2">
                                </td>
                                <td>
                                    <input onchange="changeDiscount()" class="input-mini currency ck3" value="@item.c_chiet_khau3.ToString("#,##0")" type="text" data-thousands="," data-decimal="." data-precision="0" placeholder="CK3">
                                </td>
                                <td>
                                    <input onchange="SumMoneyServiceContractPR()" class="input-mini currency moneyAfterDiscount" value="@item.c_don_gia_sau_ck.ToString("#,##0")" type="text" data-thousands="," data-decimal="." data-precision="0" placeholder="Đã CK">
                                </td>
                                <td>
                                    @if (!item.c_ngay_tra_tien.ToString("dd-MM-yyyy").Contains("01-01-1900"))
                                    {
                                        <input class="date-picker input-mini datePayment" value="@item.c_ngay_tra_tien.ToString("dd/MM/yyyy")" type="text" data-date-format="dd/mm/yyyy" placeholder="dd/mm/yyyy" style="width:65px" />
                                    }
                                    else
                                    {
                                        <input class="date-picker input-mini datePayment" value="" type="text" data-date-format="dd/mm/yyyy" placeholder="dd/mm/yyyy" style="width:65px" />
                                    }
                                </td>
                                <td>
                                    <input class="input-mini currency money" type="text" value="@item.c_tien_tra.ToString("#,##0")" data-thousands="," data-decimal="." data-precision="0" placeholder="Số tiền">
                                </td>
                                <td>
                                    <input class="input-mini packageLable" type="text" value="@item.c_label" placeholder="Nhãn hàng">
                                </td>
                                <td>
                                    <input class="input-mini note" type="text" value="@item.c_note" placeholder="Ghi chú">
                                </td>
                                <td>
                                    <button type="button" onclick="minusContractPR(this)" class="btn btn-minier btn-danger"><i class="icon-trash"></i></button>
                                </td>
                            </tr>

                                        }
                    </tbody>
                                        }
                                        else
                                        {
                                            if (ViewBag.listServices != null && ViewBag.listServices.Count > 0)
                                            {
                                                <tbody>
                                                    @foreach (var item in ViewBag.listServices)
                                                    {

                                                        <tr data-pkservice="@item.pk_services">
                                                            <td>#</td>
                                                            <td>@glb_stt</td> @{glb_stt++;}
                                                            <td>
                                                                <input class="input-value-suggess item-pk-services" type="hidden" value="0" />
                                                                <input class="input-mini bookcode" type="text" value="@item.c_book_code" placeholder="Mã book">
                                                            </td>
                                                            <td>
                                                                <input class="date-picker input-mini dateUp" type="text" value="@item.NgayLen.ToString("dd/MM/yyyy")" data-date-format="dd/mm/yyyy" placeholder="dd/mm/yyyy" style="width:65px" />
                                                            </td>
                                                            <td>
                                                                <input class="input-value-suggess item-time" type="hidden" value="@item.GioLen" />
                                                                @(Html.Kendo().AutoComplete()
                                        .Name("txt-Adv-contractPR-" + glb_contractPR)
                                        .DataTextField("Name")
                                        .Placeholder("Giờ lên")
                                        .Filter("contains")
                                        .MinLength(1)
                                        .HtmlAttributes(new { style = "width:100%", @onfocus = "setGlobalPackage(" + glb_contractPR + ")" })
                                        .DataSource(source =>
                                        {
                                            source.Read(read =>
                                            {
                                                read.Action("SuggestTime", "CRM_ProposedAdvertisement", new { PKList = 72 })
                                                    .Data("onDataContractPR");
                                            })
                                            .ServerFiltering(true);
                                        })
                                        .Events(e =>
                                        {
                                            e.Select("onSelectContractPRItem");
                                        })
                                                                )
                                                                <script>
                                                                    $("#txt-Adv-contractPR-@glb_contractPR").val("@Html.Raw(item.GioLen)");
                                                                </script>
                                                                @{glb_contractPR++;}
                                                            </td>
                                                            <td>
                                                                <input class="input-value-suggess item-web1" type="hidden" value="khampha.vn" />
                                                                @(Html.Kendo().AutoComplete()
                                        .Name("txt-Adv-contractPR-" + glb_contractPR)
                                        .DataTextField("Name")
                                        .Placeholder("Website")
                                        .Filter("contains")
                                        .MinLength(1)
                                        .HtmlAttributes(new { style = "width:100%", @class = "input-mini", @onfocus = "setGlobalPackage(" + glb_contractPR + ")" })
                                        .DataSource(source =>
                                        {
                                            source.Read(read =>
                                            {
                                                read.Action("SuggestWebsite", "CRM_ProposedAdvertisement", new { PKList = 20 })
                                                    .Data("onDataContractPR");
                                            })
                                            .ServerFiltering(true);
                                        })
                                        .Events(e =>
                                        {
                                            e.Select("onSelectContractPRItem");
                                        })
                                                                )
                                                                <script>
                                                                    $("#txt-Adv-contractPR-@glb_contractPR").val("khampha.vn");
                                                                </script>
                                                                @{glb_contractPR++;}
                                                            </td>
                                                            <td>
                                                                <input class="input-value-suggess item-web2" type="hidden" value="@item.WebsiteID" />
                                                                @(Html.Kendo().AutoComplete()
                                        .Name("txt-Adv-contractPR-" + glb_contractPR)
                                        .DataTextField("Name")
                                        .Placeholder("Website")
                                        .Filter("contains")
                                        .MinLength(1)
                                        .HtmlAttributes(new { style = "width:100%", @class = "input-mini", @onfocus = "setGlobalPackage(" + glb_contractPR + ")" })
                                        .DataSource(source =>
                                        {
                                            source.Read(read =>
                                            {
                                                read.Action("SuggestWebsite", "CRM_ProposedAdvertisement", new { PKList = 20 })
                                                    .Data("onDataContractPR");
                                            })
                                            .ServerFiltering(true);
                                        })
                                        .Events(e =>
                                        {
                                            e.Select("onSelectContractPRItem");
                                        })
                                                                )
                                                                <script>
                                                                    $("#txt-Adv-contractPR-@glb_contractPR").val("@Html.Raw(item.WebsiteName)");
                                                                </script>
                                                                @{glb_contractPR++;}
                                                            </td>
                                                            <td>
                                                                <input class="input-value-suggess item-category" type="hidden" value="@item.CategoryID" />
                                                                @(Html.Kendo().AutoComplete()
                                        .Name("txt-Adv-contractPR-" + glb_contractPR)
                                        .DataTextField("Name")
                                        .Filter("contains")
                                        .Placeholder("Chuyên mục")
                                        .MinLength(1)
                                        .HtmlAttributes(new { style = "width:100%", @class = "input-mini", @onfocus = "setGlobalPackage(" + glb_contractPR + ")" })
                                        .DataSource(source =>
                                        {
                                            source.Read(read =>
                                            {
                                                read.Action("SuggestCategory", "CRM_ProposedAdvertisement", new { PKList = 22 })
                                                    .Data("onDataContractPR");
                                            })
                                            .ServerFiltering(true);
                                        })
                                        .Events(e =>
                                        {
                                            e.Select("onSelectContractPRItem");
                                        })
                                                                )
                                                                <script>
                                                                    $("#txt-Adv-contractPR-@glb_contractPR").val("@Html.Raw(item.CategoryName)");
                                                                </script>
                                                                @{glb_contractPR++;}
                                                            </td>
                                                            <td>
                                                                <input class="input-value-suggess item-location" type="hidden" value="@item.LocationID" />
                                                                @(Html.Kendo().AutoComplete()
                                            .Name("txt-Adv-contractPR-" + glb_contractPR)
                                            .DataTextField("Name")
                                            .Placeholder("Vị trí")
                                            .Filter("contains")
                                            .MinLength(1)
                                            .HtmlAttributes(new { style = "width:100%", @class = "input-mini", @onfocus = "setGlobalPackage(" + glb_contractPR + ")" })
                                            .DataSource(source =>
                                            {
                                                source.Read(read =>
                                                {
                                                    read.Action("SuggestLocation", "CRM_ProposedAdvertisement", new { PKList = 23 })
                                                        .Data("onDataContractPR");
                                                })
                                                .ServerFiltering(true);
                                            })
                                            .Events(e =>
                                            {
                                                e.Select("onSelectContractPRItem");
                                            })
                                                                )
                                                                <script>
                                                                    $("#txt-Adv-contractPR-@glb_contractPR").val("@Html.Raw(item.LocationName)");
                                                                </script>
                                                                @{glb_contractPR++;}
                                                            </td>
                                                            <td>
                                                                <input class="input-value-suggess item-region" type="hidden" value="@item.VungMien" />
                                                                @(Html.Kendo().AutoComplete()
                                        .Name("txt-Adv-contractPR-" + glb_contractPR)
                                        .DataTextField("Name")
                                        .Filter("contains")
                                        .Placeholder("Vùng miền")
                                        .MinLength(1)
                                        .HtmlAttributes(new { style = "width:100%", @class = "input-mini", @onfocus = "setGlobalPackage(" + glb_contractPR + ")" })
                                        .DataSource(source =>
                                        {
                                            source.Read(read =>
                                            {
                                                read.Action("SuggestRegion", "CRM_ProposedAdvertisement", new { PKList = 52 })
                                                    .Data("onDataContractPR");
                                            })
                                            .ServerFiltering(true);
                                        })
                                        .Events(e =>
                                        {
                                            e.Select("onSelectContractPRItem");
                                        })
                                                                )
                                                                <script>
                                                                    $("#txt-Adv-contractPR-@glb_contractPR").val("@Html.Raw(item.TenVungMien)");
                                                                </script>
                                                                @{glb_contractPR++;}
                                                            </td>
                                                            <td>
                                                                <input class="input stt" type="text" value="@item.Number" style="width:30px" placeholder="TT Bài">
                                                            </td>
                                                            <td>
                                                                <input onchange="SumMoneyServiceContractPR()" class="input-mini currency moneyBeforeDiscount" value="@item.c_don_gia.ToString("#,##0")" type="text" data-thousands="," data-decimal="." data-precision="0" placeholder="Tiền chưa CK">
                                                            </td>
                                                            <td>
                                                                <input onchange="changeDiscount()" class="input-mini currency ck1" value="@item.c_chiet_khau1.ToString("#,##0")" type="text" data-thousands="," data-decimal="." data-precision="0" placeholder="CK1">
                                                            </td>
                                                            <td>
                                                                <input onchange="changeDiscount()" class="input-mini currency ck2" value="@item.c_chiet_khau2.ToString("#,##0")" type="text" data-thousands="," data-decimal="." data-precision="0" placeholder="CK2">
                                                            </td>
                                                            <td>
                                                                <input onchange="changeDiscount()" class="input-mini currency ck3" value="@item.c_chiet_khau3.ToString("#,##0")" type="text" data-thousands="," data-decimal="." data-precision="0" placeholder="CK3">
                                                            </td>
                                                            <td>
                                                                <input onchange="SumMoneyServiceContractPR()" class="input-mini currency moneyAfterDiscount" value="@item.PriceCharged.ToString("#,##0")" type="text" data-thousands="," data-decimal="." data-precision="0" placeholder="Đã CK">
                                                            </td>
                                                            <td>
                                                                <input class="date-picker input-mini datePayment" type="text" data-date-format="dd/mm/yyyy" placeholder="dd/mm/yyyy" style="width:65px" />
                                                            </td>
                                                            <td>
                                                                <input class="input-mini currency money" type="text" data-thousands="," data-decimal="." data-precision="0" placeholder="Số tiền">
                                                            </td>
                                                            <td>
                                                                <input class="input-mini packageLable" type="text" placeholder="Nhãn hàng">
                                                            </td>
                                                            <td>
                                                                <input class="input-mini note" type="text" placeholder="Ghi chú">
                                                            </td>
                                                            <td>
                                                                <button type="button" onclick="minusContractPR(this)" class="btn btn-minier btn-danger"><i class="icon-trash"></i></button>
                                                            </td>
                                                        </tr>
                                                                    }
                                                </tbody>
                                                                    }
                                                                    else
                                                                    {
                                                                        <tbody></tbody>
                                                                        }

                                                                    }
            </table>

        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        SumMoneyServiceContractPR();

    })
    $('#ckb-pr').change(function () {
        if ($(this).is(":checked")) {
            $('#contractPR-table').css('display', 'inline')
        } else {
            $('#contractPR-table').css('display', 'none')
        }
    })
    var chGlbContractPR = 0;
    var contractPR = parseInt("@glb_contractPR");
    var coStt = parseInt("@glb_stt");
    function setGlobalContractPR(k) {
        chGlbContractPR = k;
    }
    function onDataContractPR() {
        return {
            text: $("#txt-Adv-contractPR-" + chGlbContractPR).val()
        };
    }
    function onSelectContractPRItem(e) {
        var element = $(this)[0].element;
        var dataItem = this.dataItem(e.item.index());
        element.parents("td").find(".input-value-suggess").val(dataItem.Code);
    }

    function plusContractPR() {
        $.post(r + "/Ajax/GetInputSuggest_DNQC_ContractPR/", { incree: parseInt(contractPR) }, function (data) {
            $("#contractPR-table").find("table").find("tbody").append(data);
            contractPR = contractPR + 6;
            $('.date-picker').datepicker();
            $('.currency').maskMoney();
        })
        return;
    }
    function minusContractPR(e) {

        var pk = $(e).closest('tr').attr("data-pkservice");
        $.ajax({
            url: r + "/CRM_ProposedAdvertisement/DeleteService",
            type: 'POST',
            data: { pkservice: pk },
            async: false,
            success: function (data, textStatus, jqXHR) {
                if (data.success) {
                    alertMessage('Thành công', 'Xóa dữ liệu thành công', true);
                    $(e).closest('tr').remove();
                }
            },
            error: function (jqXHR, textStatus, errorThrown) {
                alertMessage('Lỗi hệ thống', errorThrown, false);

            }
        });
        SumMoneyServiceContractPR();
    }


    var contractObj = {
        data: [],
        addPackage: function (pk_services, fk_adv, bookcode, ngay_len, gio, website1, website2, category, location, region, stt, dongia, ck1, ck2, ck3, moneyAfterDiscount, datePayment, money, lable, note) {
            var packageItem = {
                pk_services: pk_services,
                fk_adv: fk_adv,
                c_type: 3,
                c_book_code: bookcode,
                c_ngay_lenString: ngay_len,
                c_gio: gio,
                c_website1: website1,
                c_website2: website2,
                c_website: website2, // check again
                c_category: category,
                c_location: location,
                c_vung_mien: region,
                c_so_luong: stt,
                c_don_gia: dongia,
                c_chiet_khau1: ck1,
                c_chiet_khau2: ck2,
                c_chiet_khau3: ck3,
                c_don_gia_sau_ck: moneyAfterDiscount,
                c_ngay_tra_tienString: datePayment,
                c_tien_tra: money,
                c_label: lable,
                c_note: note
            };
            this.data.push(packageItem)
        }
    };

    function changeDiscount() {

        $("#contractPR-table").find("table").find("tbody").find('tr').each(function (index) {
            var don_gia = 0;
            don_gia = currencyToNumber($(this).find('input.moneyBeforeDiscount').val());
            var ck1 = currencyToNumber($(this).find('input.ck1').val());
            if (ck1 != 0) {
                don_gia = don_gia - (don_gia * ck1 / 100);
            }
            $(this).find('input.moneyAfterDiscount').val(don_gia);
            var ck2 = currencyToNumber($(this).find('input.ck2').val());
            if (ck2 != 0) {
                don_gia = don_gia - (don_gia * ck2 / 100);
            }
            $(this).find('input.moneyAfterDiscount').val(don_gia);
            var ck3 = currencyToNumber($(this).find('input.ck3').val());
            if (ck3 != 0) {
                don_gia = don_gia - (don_gia * ck3 / 100);
            }
            $(this).find('input.moneyAfterDiscount').val(kendo.toString(don_gia, "n0"));
        })
        SumMoneyServiceContractPR();
    }
    function SaveContractPR(pkadv, tracking) {
        var fail = false;
        var isValid = true;
        $("#contractPR-table").find("table").find("tbody").find('tr').each(function (index) {
            var pk_services = $(this).attr('data-pkservice');
            var fk_adv = pkadv;
            var book_code = $(this).find('input.bookcode').val();
            if (book_code == "") {
                alertMessage('', 'Vui lòng nhập mã book', false);
                fail = true;
                $(this).focus();
                return;
            }

            var ngay_len = convertDate($(this).find('input.dateUp').val());
            if (ngay_len == "") {
                alertMessage('', 'Vui lòng nhập ngày lên', false);
                fail = true;
                $(this).focus();
                return;
            }

            var gio = $(this).find('input.item-time').val();
            if (gio == "") {
                alertMessage('', 'Vui lòng nhập giờ lên', false);
                fail = true;
                $(this).focus();
                return;
            }

            var web1 = $(this).find('input.item-web1').val();
            if (web1 == "") {
                alertMessage('', 'Vui lòng nhập Website', false);
                fail = true;

                $(this).focus();
                return;
            }


            var web2 = $(this).find('input.item-web2').val();
            if (web2 == "") {
                alertMessage('', 'Vui lòng nhập Website', false);
                fail = true;
                $(this).focus();
                return;
            }

            var category = $(this).find('input.item-category').val();
            if (category == "") {
                alertMessage('', 'Vui lòng nhập Chuyên mục', false);
                fail = true;
                $(this).focus();
                return;
            }

            var location = $(this).find('input.item-location').val();
            if (location == "") {
                alertMessage('', 'Vui lòng nhập Vị trí', false);
                fail = true;
                $(this).focus();
                return;
            }


            var region = $(this).find('input.item-region').val();
            if (region == "") {
                alertMessage('', 'Vui lòng nhập Vùng miền', false);
                fail = true;
                $(this).focus();
                return;
            }

            var stt = $(this).find('input.stt').val();
            if (stt == "") {
                stt = 0;
            }


            var moneyBeforeDiscount = currencyToNumber($(this).find('input.moneyBeforeDiscount').val());
            if (moneyBeforeDiscount == "") {
                alertMessage('', 'Vui lòng nhập đơn giá', false);
                fail = true;
                $(this).focus();
                return;
            }

            var moneyAfterDiscount = currencyToNumber($(this).find('input.moneyAfterDiscount').val());
            if (moneyAfterDiscount == "") {
                alertMessage('', 'Vui lòng nhập Số tiền sau CK', false);
                fail = true;
                isValid = false;
                $(this).focus();
                return;
            }

            var ck1 = currencyToNumber($(this).find('input.ck1').val());
            var ck2 = currencyToNumber($(this).find('input.ck2').val());
            var ck3 = currencyToNumber($(this).find('input.ck3').val());
            var datePayment = convertDate($(this).find('input.datePayment').val());
            var money = currencyToNumber($(this).find('input.money').val());
            var packageLable = $(this).find('input.packageLable').val();
            var note = $(this).find('input.note').val();
            if (!tracking) {
                contractObj.addPackage(pk_services, fk_adv, book_code, ngay_len, gio, web1, web2, category, location, region, stt, moneyBeforeDiscount, ck1, ck2, ck3, moneyAfterDiscount, datePayment, money, packageLable, note);
            }

        })
        //console.log(contractObj.data);

        if (!tracking) {
            if (contractObj.data.length > 0) {
                $.ajax({
                    url: r + "/CRM_ProposedAdvertisement/SaveAdvService",
                    type: 'POST',
                    data: { avd: contractObj.data, c_dot_order: '@ViewBag.c_dot_order' },
                    async: false,
                    success: function (data, textStatus, jqXHR) {
                        contractObj.data = [];
                        if (data.success) {
                            $("#formAdv").attr("data-dot-order", data.c_dot_order);
                            isValid = true;
                            return true;
                        }
                        else {
                            packageObj.data = [];
                            alertMessage('Lỗi', data.message, false);
                            isValid = false;
                            return false;
                        }

                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        packageObj.data = [];
                        isValid = false;
                        alertMessage('Lỗi hệ thống', errorThrown, false);
                    }
                });
                return isValid;
            }
            else {
                return fail;
            }
        }
    }
    function showPPListBooking(e) {
        $('#txt-bookcode-goi-pr').val($('#txt-BookCode').val());
        $('#typeBook').val(e);
        $('#popup-adv-list-booking').modal('show');
    }

    function SumMoneyServiceContractPR() {
        var tong_tien_dang_dot_pr_contract = 0;
        $("#contractPR-table").find("table").find("tbody").find('tr').each(function (index) {
            var totalRow = $(this).find('input.stt').val() * currencyToNumber($(this).find('input.moneyAfterDiscount').val());
            tong_tien_dang_dot_pr_contract = tong_tien_dang_dot_pr_contract + totalRow;
        })
        $("#total-qc-this-publish").html(kendo.toString(tong_tien_dang_dot_pr_contract, "n0"));
        $('#tong_tien_dang_dot_pr_contract').html(kendo.toString(tong_tien_dang_dot_pr_contract, "n0"));
        if (!checkGiaTri()) {
            alertMessage('Lỗi', 'Tổng tiền đăng đợt này lớn hơn giá trị HD trừ đã đăng QC', false);
        }
    }
    function CloneContractPR() {

        // check row is checked:
        var isRowChecked = $("#contractPR-table").find("table").find("tbody").find('tr').find('input:checked');
        // only one row checked to clone
        if (isRowChecked.length == 0) {
            alertMessage('Lỗi', 'Chưa chọn sản phẩm để nhân bản', false);

        }
        else {
            if (isRowChecked.length > 1) {
                alertMessage('Lỗi', 'Chỉ được chọn 1 sản phẩm để nhân bản', false);

            }
            else {
                var $tr = $(isRowChecked).closest('tr');
                var obj = {};
                obj.c_book_code = $tr.find(".bookcode").val();
                obj.fk_adv = $tr.find(".fk_adv").val();
                obj.c_dot_order = $tr.find(".c_dot_order").val();
                obj.pk_services = $tr.find(".pk_services").val();
                obj.c_ngay_lenString = $tr.find(".dateUp").val();
                obj.c_gio = $tr.find(".item-time").val();
                obj.c_gio_name = $tr.find("input.item-time-name").val();
                obj.c_website1 = $tr.find(".item-web1").val();
                obj.c_website1_name = $tr.find("input.item-web1-name").val();
                obj.c_website2 = $tr.find(".item-web2").val();
                obj.c_website2_name = $tr.find("input.item-web2-name").val();
                obj.c_website = $tr.find(".item-web2").val();
                obj.c_website_name = $tr.find("input.item-web2-name").val();
                obj.c_category = $tr.find(".item-category").val();
                obj.c_category_name = $tr.find("input.item-category-name").val();
                obj.c_location = $tr.find(".item-location").val();
                obj.c_location_name = $tr.find("input.item-location-name").val();
                obj.c_vung_mien = $tr.find(".item-region").val();
                obj.c_vung_mien_name = $tr.find("input.item-region-name").val();
                obj.c_so_luong = $tr.find(".stt").val();
                obj.c_don_gia = currencyToNumber($tr.find(".moneyBeforeDiscount").val());
                obj.c_chiet_khau1 = currencyToNumber($tr.find(".ck1").val());
                obj.c_chiet_khau2 = currencyToNumber($tr.find(".ck2").val());
                obj.c_chiet_khau3 = currencyToNumber($tr.find(".ck3").val());
                obj.c_don_gia_sau_ck = currencyToNumber($tr.find(".moneyAfterDiscount").val());
                obj.c_ngay_tra_tienString = $tr.find(".datePayment").val();
                obj.c_tien_tra = currencyToNumber($tr.find(".money").val());
                obj.c_label = $tr.find(".packageLable").val();
                obj.c_note = $tr.find(".note").val();
                //console.log(obj);
                $(document).ajaxStart($.blockUI({ message: '<i class="icon-spinner icon-spin blue bigger-125" style="font-size:30px;"></i>', theme: false })).ajaxStop($.unblockUI);
                $.ajax(
                {
                    url: r + "/Ajax/DNDQC_CloneService_ContractPR",
                    type: 'POST',
                    data: { incree: parseInt(contractPR), coStt: parseInt(coStt), service: obj },
                    async: false,
                    success: function (data, textStatus, jqXHR) {
                        $("#contractPR-table").find("table").find("tbody").append(data);
                        contractPR = contractPR + 6;
                        coStt = coStt + 1;
                        $('.date-picker').datepicker();
                        $('.currency').maskMoney();
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alertMessage('Lỗi hệ thống', errorThrown, false);

                    }
                });
                SumMoneyServiceContractPR();
            }

        }
    }
</script>